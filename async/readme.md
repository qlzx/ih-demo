### TTL是什么

TTL是阿里巴巴开发的一个ThreadLocal安全传递的一个框架。在使用线程池等池化复用线程的情况下，提供ThreadLocal值的传递功能，解决异步上下文传递的问题。

JDK的`InheritableThreadLocal`类可以完成父线程到子线程的值传递。

`InheritableThreadLocal`类的核心是java在创建线程的时候同时会将父线程的inheritableThreadLocalMap拷贝到当前线程的inheritableThreadLocalMap


### 池化复用的问题

对于使用线程池等会池化复用线程的执行组件的情况，线程由线程池创建好，并且线程是池化起来反复使用的；

这时父子线程关系的ThreadLocal值传递已经没有意义，应用需要的实际上是把任务提交给线程池时的ThreadLocal值传递到`任务执行时`。

一般性的情况下我们可以定制运行的Task，即在Runnable实例绑定提交任务时的ThreadLocal做为成员变量来处理任务。 在执行真正的任务之前将这个捕获的数据再塞到ThreadLocal中。


#### 线程变量清理问题

在上面线程池中还

如果清理操作漏了：
下一次执行可能是上次的，即『上下文的 污染/串号』，会导致业务逻辑错误。
『上下文的 泄漏』，会导致内存泄漏问题。
如果清理操作做多了，会出现上下文 丢失。
`需要保证不会因为线程池没有以异步线程来处理任务的时候导致误清理了线程变量.


### TTL解决方案









